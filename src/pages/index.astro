---
import BaseLayout from "../layouts/BaseLayout.astro";
import HorizontalCard from "../components/HorizontalCard.astro";
import LeadMagnetCTA from "../components/LeadMagnetCTA.astro";
import NewsletterForm from "../components/NewsletterForm.astro";
import GoogleReviews from "../components/GoogleReviews.astro";
import { getCollection } from "astro:content";
import createSlug from "../lib/createSlug";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const last_posts = posts.slice(0, 3);
---

<BaseLayout sideBarActiveItemID="home">
  <!-- Hero Section - Minimal -->
  <div class="py-16">
    <p class="text-sm uppercase tracking-widest text-primary/60 mb-4">
      Laboratoire Digital
    </p>

    <h1 class="text-4xl md:text-5xl font-bold leading-tight mb-6">
      SEO & CRO Testés.<br />
      Résultats Prouvés.
    </h1>

    <p class="text-lg text-base-content/70 max-w-xl mb-10">
      Expériences, études de cas et guides basés sur des données réelles — pas
      des opinions.
    </p>

    <div class="flex gap-4">
      <a class="btn btn-primary" href="#labs">Explorer</a>
      <a href="#newsletter" class="btn btn-ghost">Newsletter</a>
    </div>
  </div>

  <!-- Labs Section - Minimal Grid -->
  <section id="labs" class="py-16 border-t border-base-300">
    <h2 class="text-2xl font-bold mb-10">Labs</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <a href="/seo" class="group block">
        <p class="text-sm text-primary/60 mb-1">01</p>
        <h3
          class="text-xl font-semibold group-hover:text-primary transition-colors"
        >
          SEO
        </h3>
        <p class="text-base-content/60 mt-2">
          Référencement naturel, technique, contenu.
        </p>
      </a>

      <a href="/cro" class="group block">
        <p class="text-sm text-primary/60 mb-1">02</p>
        <h3
          class="text-xl font-semibold group-hover:text-primary transition-colors"
        >
          CRO
        </h3>
        <p class="text-base-content/60 mt-2">
          Optimisation conversions, tests A/B, tunnels.
        </p>
      </a>

      <a href="/shopify" class="group block">
        <p class="text-sm text-primary/60 mb-1">03</p>
        <h3
          class="text-xl font-semibold group-hover:text-primary transition-colors"
        >
          Shopify
        </h3>
        <p class="text-base-content/60 mt-2">
          Vitesse, SEO, conversions e-commerce.
        </p>
      </a>

      <a href="/wordpress" class="group block">
        <p class="text-sm text-primary/60 mb-1">04</p>
        <h3
          class="text-xl font-semibold group-hover:text-primary transition-colors"
        >
          WordPress
        </h3>
        <p class="text-base-content/60 mt-2">Performance, plugins, headless.</p>
      </a>
    </div>
  </section>

  <!-- Google Reviews Section -->
  <GoogleReviews />

  <!-- Articles Section - Minimal -->
  <section class="py-16 border-t border-base-300">
    <div class="flex justify-between items-center mb-10">
      <h2 class="text-2xl font-bold">Articles récents</h2>
      <a href="/blog" class="text-sm text-primary hover:underline"
        >Voir tout →</a
      >
    </div>

    <div class="space-y-8">
      {
        last_posts.map((post) => (
          <a
            href={"/blog/" + createSlug(post.data.title, post.slug)}
            class="group block"
          >
            <article class="border-b border-base-300 pb-8">
              <h3 class="text-lg font-medium group-hover:text-primary transition-colors">
                {post.data.title}
              </h3>
              <p class="text-base-content/60 mt-2 line-clamp-2">
                {post.data.description}
              </p>
            </article>
          </a>
        ))
      }
    </div>
  </section>

  <!-- Newsletter -->
  <NewsletterForm
    title="Newsletter"
    description="Recevez les résultats de nos expériences. Pas de spam."
  />
</BaseLayout>
